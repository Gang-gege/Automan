(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-57c2db28"],{5748:function(t,e,n){"use strict";n("a5c6")},"7db0":function(t,e,n){"use strict";var o=n("23e7"),c=n("b727").find,r=n("44d2"),i="find",a=!0;i in[]&&Array(1)[i]((function(){a=!1})),o({target:"Array",proto:!0,forced:a},{find:function(t){return c(this,t,arguments.length>1?arguments[1]:void 0)}}),r(i)},"9f52":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.topic?n("div",{staticClass:"details"},[n("Panel",{staticClass:"content",scopedSlots:t._u([{key:"header",fn:function(){return[n("h2",[t._v("文章详情")])]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"topic-title"},[t.topic.top||t.topic.good?n("span",{class:t.topic.top||t.topic.good?"tab":""},[t._v(t._s(t._f("formatTab")(t.topic)))]):t._e(),n("h3",[t._v(t._s(t.topic.title))]),t.isLogin?n("el-button",{staticClass:"collect",attrs:{type:t.topic.is_collect?"danger":"primary"},on:{click:function(e){return t.collect(t.topic.is_collect)}}},[t._v(t._s(t.topic.is_collect?"取消收藏":"收藏"))]):t._e()],1),n("hr"),n("div",{staticClass:"topic-content"},[n("div",{domProps:{innerHTML:t._s(t.topic.content)}})])]},proxy:!0}],null,!1,1075171436)}),n("Panel",{staticClass:"replys",scopedSlots:t._u([{key:"header",fn:function(){return[n("span",[t._v(t._s(t.topic.reply_count)+"回复")])]},proxy:!0},{key:"content",fn:function(){return t._l(t.topic.replies,(function(e,o){return n("div",{key:o,staticClass:"reply"},[n("div",{staticClass:"front-back"},[n("div",{staticClass:"front"},[n("el-avatar",{style:{cursor:"pointer",verticalAlign:"middle",marginRight:"10px"},attrs:{title:e.author.loginname,shape:"square",size:30,src:e.author.avatar_url}}),n("span",{staticClass:"loginname"},[t._v(t._s(e.author.loginname))]),n("span",{staticClass:"floor"},[t._v(t._s(o+1)+"楼·"+t._s(t.$moment(e.create_at).fromNow()))])],1),n("div",{staticClass:"behind"},[t.isLogin?n("span",{class:e.is_uped?"iconfont icon-dianzan ":"iconfont icon-dianzan1 ",on:{click:function(n){return t.up_click(e.id)}}}):n("span",{staticClass:"iconfont icon-dianzan1",on:{click:t.noLogin_click}}),0!==e.ups.length?n("span",{staticClass:"ups"},[t._v(t._s(e.ups.length))]):t._e(),t.isLogin?n("span",{staticClass:"iconfont icon-icon_reply",on:{click:function(n){return t.otherAddForm(e)}}}):t._e()])]),n("div",{staticClass:"reply_content",domProps:{innerHTML:t._s(e.content)}}),e.id===t.comment_id?n("div",{staticClass:"reply_other"},[n("quill-editor",{ref:"quill",refInFor:!0,model:{value:t.comment_text,callback:function(e){t.comment_text=e},expression:"comment_text"}}),n("el-button",{staticClass:"newComment",attrs:{type:"primary"},on:{click:function(n){return t.otherSubmit(e.id)}}},[t._v("回复")])],1):t._e()])}))},proxy:!0}],null,!1,4095624882)}),t.$store.state.token?n("Panel",{staticClass:"comment",scopedSlots:t._u([{key:"header",fn:function(){return[t._v(" 新建评论 ")]},proxy:!0},{key:"content",fn:function(){return[n("quill-editor",{model:{value:t.addForm,callback:function(e){t.addForm=e},expression:"addForm"}}),n("el-button",{staticClass:"newComment",attrs:{type:"primary"},on:{click:t.submit}},[t._v("回复")])]},proxy:!0}],null,!1,2332330966)}):t._e()],1):t._e()},c=[],r=n("1da1"),i=(n("96cf"),n("99af"),n("7db0"),n("89d7")),a={data:function(){return{topic:null,addForm:"",comment_id:"",comment_text:""}},computed:{isLogin:function(){return this.$store.state.token}},components:{Panel:i["a"]},created:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var n,o,c,r,i,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.$route.params.topicId,o=t.$store.state.token,c=t.$store.state.token,r=c?"/topic/".concat(n,"?accesstoken=").concat(o):"/topic/".concat(n),e.next=6,t.$axios.get(r);case 6:return i=e.sent,t.topic=i.data,a=t.topic.author.loginname,e.next=11,t.$axios.get("/user/".concat(a));case 11:s=e.sent,t.$store.commit("getUserInfo",s.data);case 13:case"end":return e.stop()}}),e)})))()},methods:{up_click:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var o,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$axios.post("/reply/".concat(t,"/ups"),{accesstoken:e.$store.state.token});case 2:o=n.sent,console.log(e.topic.replies),c=e.topic.replies.find((function(e){return e.id===t})),c.is_uped="up"===o.action,c.is_uped?c.ups.push(e.$store.state.userInfo.id):c.ups.pop();case 7:case"end":return n.stop()}}),n)})))()},noLogin_click:function(){this.$message("请先登录，登录之后方可点赞")},collect:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t){n.next=6;break}return n.next=3,e.$axios.post("/topic_collect/de_collect",{accesstoken:e.$store.state.token,topic_id:e.$route.params.topicId});case 3:n.sent,n.next=9;break;case 6:return n.next=8,e.$axios.post("/topic_collect/collect",{accesstoken:e.$store.state.token,topic_id:e.$route.params.topicId});case 8:n.sent;case 9:e.topic.is_collect=!t;case 10:case"end":return n.stop()}}),n)})))()},submit:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var n,o,c,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=localStorage.getItem("localToken"),o=JSON.parse(localStorage.getItem("localUserInfo")),console.log(n,o),c=t.addForm,!c){e.next=11;break}return e.next=7,t.$axios.post("topic/".concat(t.topic.id,"/replies"),{accesstoken:n,content:c});case 7:r=e.sent,i={id:r.reply_id,is_uped:!1,ups:[],content:c,author:{avatar_url:o.avatar_url,loginname:o.loginname}},t.topic.replies.push(i),t.addForm="";case 11:case"end":return e.stop()}}),e)})))()},otherAddForm:function(t){var e=t.id,n=t.author;this.comment_id=e,this.comment_text="<a href='/user/".concat(n.loginname,"'>@").concat(n.loginname,"</a> "),this.$nextTick((function(){this.$refs.quill[0].$refs.editor.focus()}))},otherSubmit:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,o,c,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=localStorage.getItem("localToken"),o=JSON.parse(localStorage.getItem("localUserInfo")),c=e.comment_text,!c){t.next=11;break}return t.next=6,e.$axios.post("topic/".concat(e.topic.id,"/replies"),{accesstoken:n,content:c});case 6:r=t.sent,i={id:r.reply_id,is_uped:!1,ups:[],content:c,author:{avatar_url:o.avatar_url,loginname:o.loginname}},e.topic.replies.push(i),e.comment_text="",e.comment_id="";case 11:case"end":return t.stop()}}),t)})))()}}},s=a,l=(n("5748"),n("2877")),u=Object(l["a"])(s,o,c,!1,null,null,null);e["default"]=u.exports},a5c6:function(t,e,n){}}]);
//# sourceMappingURL=chunk-57c2db28.3610fb16.js.map